<?php
  $urls = [
      'total' => "http://localhost:8983/solr/biblio/select?indent=true&q.op=OR&q=*%3A*&useParams=&wt=json",
      'articles' => "http://localhost:8983/solr/biblio/select?indent=true&q.op=OR&q=collection%3AOJS&useParams=&wt=json",
      'thesis' => "http://localhost:8983/solr/biblio/select?indent=true&q.op=OR&q=collection%3ADSpace&useParams=&wt=json"
  ];


  function fetch_data($url) {
      $response = file_get_contents($url);
      if ($response === false) {
          return null; 
      }
      $data = json_decode($response, true);
      if ($data === null) {
          return null; 
      }
      return $data['response']['numFound'] ?? null; 
  }

  $documents = fetch_data($urls['total']);
  $all_articles = fetch_data($urls['articles']);
  $all_thesis = fetch_data($urls['thesis']);
?>

<div class="counter-home">
  <div class="row">
    <div class="col-md-4">
      <h3 class="number" data-value="<?=$documents?>"> 0 </h3>
      <h3>Documentos</h3>
    </div>
    <div class="col-md-4">
      <h3 class="number" data-value="<?=$all_articles?>"> 0 </h3>
      <h3>Art√≠culos</h3>
    </div>
    <div class="col-md-4">
      <h3 class="number" data-value="<?=$all_thesis?>"> 0 </h3>
      <h3>Tesis</h3>
    </div>
  </div>
</div>

<script type="text/javascript">
function animateNumber(element, start, end, duration) {
    let range = end - start;
    let stepTime = Math.abs(Math.floor(duration / range));
    let current = start;
    let increment = end > start ? 1 : -1;

    let timer = setInterval(function() {
        current += increment;
        element.textContent = current.toLocaleString('en-US');
        if (current == end) {
            clearInterval(timer); 
        }
    }, stepTime);
}

document.querySelectorAll('.number').forEach(function(h3) {
    let endValue = parseInt(h3.getAttribute('data-value')); 
    let startValue = endValue > 30 ? endValue - 30 : 0; 
    animateNumber(h3, startValue, endValue, 2000); 
});
</script>